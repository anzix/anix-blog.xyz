<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="utf-8">
	<!--Это будет видно на вкладке браузера-->
	<!--Наименования загаловков вкладок-->
	
    <title>Сканер Epson Perfection 1270 на Arch Linux</title>
	
	<!--Resize текста и постов для смартфонов-->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--TODO: Иконка во вкладке браузера-->
	<!--<link rel="icon" type="image/png" href="/favicon.ico"> -->
	<!--RSS автообнаружение-->
	
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://anzix.github.io/rss.xml">
	
	<!--Стилизация сайта-->
	<link rel="stylesheet" href="/assets/css/style.css">
	<!--Предзагрузка ассетов для оптимизации сайта-->
	<link rel="preload" href="/assets/fonts/Cozette/CozetteVector.ttf" as="font" type="font/ttf"
		crossorigin="anonymous">
	<link rel="preload" href="/assets/css/comparison.css" as="style">
	<!--Таблички-->
	<link rel="stylesheet" href="/assets/css/comparison.css">
</head>

<body>
	<div class="contents">
		<div class="twocols">
			<div class="navcol">
				<nav>
					<div class="fixedcol">
						<h3>Навигация</h3>
						<ul>
							<li> <a href="/">Главная</a></li>
							<li> <a href="/posts">Посты</a></li>
							<li> <a href="/tags">Теги</a></li>
							<li> <a href="/categories">Категории</a></li>
							<li> <a href="/pages/search">Поиск</a></li>
						</ul>
					</div>
				</nav>
			</div>
			<div class="maincol">
				

<h1 class="title">
  Сканер Epson Perfection 1270 на Arch Linux
</h1>

<!--Если в странице есть updated, показать её-->

<p class="subtitle"><strong>2023-03-04T22:30:20+05:00</strong></p>


    
         <a href="https://anzix.github.io/tags/linux/">linux</a>

<br>


	<aside id="toc-aside" class="toc">
	    <details>
			<summary>Оглавление</summary>
	        <ol>
	            <li>
	                <a href="#problema">Проблема</a>
	                
	            </li>
	        </ol>
		</details>
	</aside>


<p>При подключении сканера:</p>
<p>Вывод в dmesg</p>
<pre data-lang="txt" style="background-color:#2b303b;color:#ffffff;" class="language-txt "><code class="language-txt" data-lang="txt"><span style="color:#f9f9f9;">....
</span><span style="color:#f9f9f9;">[дек23 20:40] usb 1-1.1: new high-speed USB device number 3 using ehci-pci
</span><span style="color:#f9f9f9;">[  +0,081864] usb 1-1.1: New USB device found, idVendor=04b8, idProduct=0120, bcdDevice= 1.10
</span><span style="color:#f9f9f9;">[  +0,000010] usb 1-1.1: New USB device strings: Mfr=1, Product=2, SerialNumber=0
</span><span style="color:#f9f9f9;">[  +0,000005] usb 1-1.1: Product: EPSON Scanner
</span><span style="color:#f9f9f9;">[  +0,000004] usb 1-1.1: Manufacturer: EPSON
</span><span style="color:#f9f9f9;">....
</span></code></pre>
<pre data-lang="bash" style="background-color:#2b303b;color:#ffffff;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#f9f9f9;">lsusb
</span></code></pre>
<pre data-lang="txt" style="background-color:#2b303b;color:#ffffff;" class="language-txt "><code class="language-txt" data-lang="txt"><span style="color:#f9f9f9;">....
</span><span style="color:#f9f9f9;">Bus 001 Device 003: ID 04b8:0120 Seiko Epson Corp. GT-7400U [Perfection 1270]
</span><span style="color:#f9f9f9;">...
</span></code></pre>
<pre data-lang="bash" style="background-color:#2b303b;color:#ffffff;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#f9f9f9;">sane-find-scanner
</span></code></pre>
<pre data-lang="txt" style="background-color:#2b303b;color:#ffffff;" class="language-txt "><code class="language-txt" data-lang="txt"><span style="color:#f9f9f9;">....
</span><span style="color:#f9f9f9;">found USB scanner (vendor=0x04b8 [EPSON], product=0x0120 [EPSON Scanner]) at libusb:001:003
</span><span style="color:#f9f9f9;">....
</span><span style="color:#f9f9f9;">  # Your USB scanner was (probably) detected. It may or may not be supported by
</span><span style="color:#f9f9f9;">  # SANE. Try scanimage -L and read the backend&#39;s manpage.
</span><span style="color:#f9f9f9;">
</span><span style="color:#f9f9f9;">  # Not checking for parallel port scanners.
</span><span style="color:#f9f9f9;">
</span><span style="color:#f9f9f9;">  # Most Scanners connected to the parallel port or other proprietary ports
</span><span style="color:#f9f9f9;">  # can&#39;t be detected by this program.
</span><span style="color:#f9f9f9;">
</span><span style="color:#f9f9f9;">  # You may want to run this program as root to find all devices. Once you
</span><span style="color:#f9f9f9;">  # found the scanner devices, be sure to adjust access permissions as
</span><span style="color:#f9f9f9;">  # necessary.
</span></code></pre>
<p>Присваиваем группу scanner для доступа к sane non-root пользователю, также присваиваем группу lp для избежания проблем с вводом/выводом и пропаданием сканера (лично я сталкивался с этим)</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#ffffff;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#f9f9f9;">sudo</span><span style="color:#ffee80;"> usermod</span><span style="color:#f9f9f9;"> -aG</span><span style="color:#ffee80;"> scanner,lp </span><span style="color:#f9f9f9;">$(whoami)
</span></code></pre>
<p>Устанавливаем пакеты</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#ffffff;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#f9f9f9;">sudo</span><span style="color:#ffee80;"> pacman</span><span style="color:#f9f9f9;"> -S</span><span style="color:#ffee80;"> sane sane-airscan ipp-usb xsane
</span></code></pre>
<ul>
<li>sane - основной пакет для сканеров</li>
<li>sane-airscan (на всякий) - для сканеров которые работают в режиме «без драйверов»</li>
<li>ipp-usb - для сканеров которые работают по USB</li>
<li>xsane - Функциональное ПО для выполнения сканирования документов</li>
</ul>
<p>Разрешаем использование протокола IPP через соединение USB включив данный сервис</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#ffffff;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#f9f9f9;">sudo</span><span style="color:#ffee80;"> systemctl enable</span><span style="color:#f9f9f9;"> --now</span><span style="color:#ffee80;"> ipp-usb.service
</span></code></pre>
<p>Однако данный сканер не работает "из коробки" об этом свидетельствует выхлоп из команды <code>scanimage -L</code>, который был пуст</p>
<p><span style="color:green">РЕШЕНИЕ</span>: Из <a rel="noopener nofollow noreferrer" target="_blank" href="https://wiki.archlinux.org/title/SANE/Scanner-specific_problems#Epson_Perfection_1270">Arch Wiki (Scanner-specific problem)</a>, <a rel="noopener nofollow noreferrer" target="_blank" href="http://wiki.rosalab.ru/ru/index.php/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%B4%D0%BB%D1%8F_%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B_%D1%81%D0%BA%D0%B0%D0%BD%D0%B5%D1%80%D0%B0_Epson_Perfection_1270">Rosa Wiki (Настройка для работы сканера Epson Perfection 1270)</a> и на <a rel="noopener nofollow noreferrer" target="_blank" href="http://www.sane-project.org/sane-backends#:~:text=Requires%20firmware%20esfw3e.bin.%0Aoverseas%20version%20of%20the%20GT%2D7400U">офф сайте Sane в списке поддерживаемых устройств (Current Stable SANE Version)</a> указано что что для данного сканера необходима прошивка Esfw3e.bin взятый из:</p>
<ol>
<li>Из распакованных драйверов <a rel="noopener nofollow noreferrer" target="_blank" href="https://epson.com/Support/Scanners/Perfection-Series/Epson-Perfection-1270/s/SPT_B11B166081">Epson</a>, а именно разархивировав <strong>ModUsd.cab</strong> при помощи <code>cabextract</code> внутри которого будет данный файл прошивки</li>
<li>Вытащить данный файл из установленного Windows раздела находящийся по пути C:\Windows\System32</li>
</ol>
<p>Вытащив данный файл прошивки я копирую его в данный путь</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#ffffff;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#f9f9f9;">sudo</span><span style="color:#ffee80;"> cp Esfw3e.bin /usr/share/sane/snapscan
</span></code></pre>
<p>После чего редактирую данный конфиг файл и меняю в <code>firmware [путь до файла Esfw3e.bin]</code></p>
<pre data-lang="bash" style="background-color:#2b303b;color:#ffffff;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#f9f9f9;">sudo -e</span><span style="color:#ffee80;"> /etc/sane.d/snapscan.conf
</span></code></pre>
<pre data-lang="bash" style="background-color:#2b303b;color:#ffffff;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#f9f9f9;">....
</span><span style="color:#f9f9f9;">firmware</span><span style="color:#ffee80;"> /usr/share/sane/snapscan/Esfw3e.bin
</span><span style="color:#f9f9f9;">....
</span></code></pre>
<p>Там же в самом низу добавляем</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#ffffff;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#f9f9f9;">...
</span><span style="color:#f9f9f9;">#</span><span style="font-style:italic;color:#0088ff;"> Epson Perfection 1270
</span><span style="color:#f9f9f9;">usb</span><span style="color:#ffee80;"> 0x04b8 0x0120
</span><span style="color:#f9f9f9;">...
</span></code></pre>
<blockquote>
<p>Примечание: информацию о коде (usb 0x04b8 0x0120) можно получить с помощью команды <code>sane-find-scanner</code></p>
</blockquote>
<p>Также добавляем данные строки чтобы настроить свои привилегии</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#ffffff;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#f9f9f9;">sudo</span><span style="color:#ffee80;"> mkdir</span><span style="color:#f9f9f9;"> -p</span><span style="color:#ffee80;"> /etc/hotplug/usb/
</span><span style="color:#f9f9f9;">sudo -e</span><span style="color:#ffee80;"> /etc/hotplug/usb/libsane.usermap
</span></code></pre>
<pre data-lang="bash" style="background-color:#2b303b;color:#ffffff;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#f9f9f9;">#</span><span style="font-style:italic;color:#0088ff;"> Epson Perfection 1270
</span><span style="color:#f9f9f9;">libusbscanner</span><span style="color:#ffee80;"> 0x0003 0x04b8 0x0120 0x0000 0x0000 0x00 0x00 0x00 0x00 0x00 0x00 0x00000000
</span></code></pre>
<p>После переподключения сканера при выполнении сканирования используя команду <code>scanimage -L</code> определился</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#ffffff;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#f9f9f9;">...
</span><span style="color:#f9f9f9;">device</span><span style="color:#ffee80;"> snapscan:libusb:001:007 is a EPSON EPSON Scanner flatbed scanner
</span><span style="color:#f9f9f9;">...
</span></code></pre>
<blockquote>
<p>Примечание: Чтобы сканер работал правильно необходимо отключать калибровку качества, с калибровкой при сканировании появляются неправильные цвета. Ниже приведены примеры как отключить данную калибровку.</p>
</blockquote>
<p><code>scanimage</code> (сканирование через терминал):</p>
<ul>
<li>добавляем опцию <code>--quality-cal=no</code></li>
</ul>
<p>Пример сканирования через терминал:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#ffffff;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#f9f9f9;">scanimage --device</span><span style="color:#ffee80;"> snapscan</span><span style="color:#f9f9f9;"> --quality-cal</span><span style="color:#ff9d00;">=</span><span style="color:#ffee80;">no</span><span style="color:#f9f9f9;"> --resolution</span><span style="color:#ffee80;"> 300</span><span style="color:#f9f9f9;"> --format</span><span style="color:#ff9d00;">=</span><span style="color:#ffee80;">png</span><span style="color:#f9f9f9;"> --output-file</span><span style="color:#ffee80;"> test.png</span><span style="color:#f9f9f9;"> --progress
</span></code></pre>
<p>xsane:</p>
<ul>
<li>в окне "Стандартные параметры" снять галочку "Калибровка качества"</li>
</ul>
<h1 id="problema"><a class="anchor" href="#problema">#</a>&nbsp;
Проблема</h1>
<p>В текущий момент сканер работает стабильно, однако на отсканированном справа появляется толстый белый горизонтальный прямоугольник с разноцветными линиями внутри. Это происходит на <code>scanimage</code> и xsane. С <a rel="noopener nofollow noreferrer" target="_blank" href="https://eugeneap.livejournal.com/3630.html#:~:text=%D0%9E%D1%81%D1%82%D0%B0%D0%BB%D0%B0%D1%81%D1%8C%20%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%B0%20%2D%20%D1%80%D0%B0%D0%B7%D0%BD%D0%BE%D1%86%D0%B2%D0%B5%D1%82%D0%BD%D0%B0%D1%8F%20%D0%BF%D0%BE%D0%BB%D0%BE%D1%81%D0%B0%20%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%B0%20%D0%BF%D1%80%D0%B8%20%D1%81%D0%BA%D0%B0%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B8%20%D1%88%D0%B8%D1%80%D0%B8%D0%BD%D0%BE%D0%B9%20%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D0%BD%D0%BE%20%D1%82%D1%80%D0%B5%D1%82%D1%8C%20%D0%BB%D0%B8%D1%81%D1%82%D0%B0.%20%D0%9A%D0%B0%D0%BA%20%D0%B1%D0%BE%D1%80%D0%BE%D1%82%D1%8C%20%2D%20%D1%84%D0%B8%D0%B3%20%D0%B5%D0%B3%D0%BE%20%D0%B7%D0%BD%D0%B0%D0%B5%D1%82">данной проблемой сталкиваюсь не один я</a>. Полноценного решения как это исправить я пока не нашёл, только временные решения.</p>
<p><span style="color:green">Временные решения</span>:</p>
<p>Для xsane: обойти это можно просто выделить участок на предварительном сканировании и на отсканированном файле будет без линий.</p>
<p>Для scanimage: обойти это можно при помощи опций <code>-y</code> (число высоты) <code>-x</code> (число ширины) обрезав ширину размера документа:
<code>-x 165 -y 297</code></p>


				<footer class="center">
					<hr>
					<div class="sociallinks">
						<!--TODO: добавить EMAIL-->
						<a title="Boosty (Поддержать меня)" href="https://boosty.to/an1x" target="_blank"
							rel="noopener nofollow noreferrer" class="eachsociallinks"><img
								src="/assets/images/social-icons/Boosty_Logo.png" alt="Boosty"></a>
						<a title="Я в Steam" href="https://steamcommunity.com/id/An_iX" target="_blank"
							rel="noopener nofollow noreferrer" class="eachsociallinks"><img
								src="/assets/images/social-icons/steam-icon.png" alt="Steam"></a>
						<a title="Мои отчёты в ProtonDB" href="https://www.protondb.com/users/210885854" target="_blank"
							rel="noopener nofollow noreferrer" class="eachsociallinks"><img
								src="/assets/images/social-icons/Proton-logo.svg.png" alt="ProtonDB"></a>
						<a title="Я на GitHub" href="https://github.com/anzix" target="_blank"
							rel="noopener nofollow noreferrer" class="eachsociallinks"><img
								src="/assets/images/social-icons/github.png" alt="GitHub"></a>
						<a href="/rss.xml" target="_blank" rel="noopener nofollow noreferrer" class="eachsociallinks"
							title="Мой RSS фид"><img src="/assets/images/social-icons/rssfeed.png" alt="RSS Фид"></a>
					</div>
					<!-- TODO: Добавить URL лицензии -->
					<p><span class="copyleft">&copy;</span> Авторское право <a href="/">AniX</a>, <a href="!TODO!"
							target="_blank" rel="noopener nofollow noreferrer">AGPL-3.0</a> лицензированный.</p>
					<p>Работает на <a href="https://www.getzola.org/" target="_blank"
							rel="noopener nofollow noreferrer">zola</a>.</p>
				</footer>
			</div>
		</div>
	</div>
</body>

</html>
