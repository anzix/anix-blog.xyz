<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="utf-8">
	<!--Это будет видно на вкладке браузера-->
	<!--Наименования загаловков вкладок-->
	
    <title>!OBS на Arch Linux</title>
	
	<!--Resize текста и постов для смартфонов-->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--TODO: Иконка во вкладке браузера-->
	<!--<link rel="icon" type="image/png" href="/favicon.ico"> -->
	<!--RSS автообнаружение-->
	
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://anzix.github.io/rss.xml">
	
	<!--Стилизация сайта-->
	<link rel="stylesheet" href="/assets/css/style.css">
	<!--Предзагрузка ассетов для оптимизации сайта-->
	<link rel="preload" href="/assets/fonts/Cozette/CozetteVector.ttf" as="font" type="font/ttf"
		crossorigin="anonymous">
	<link rel="preload" href="/assets/css/comparison.css" as="style">
	<!--Таблички-->
	<link rel="stylesheet" href="/assets/css/comparison.css">
</head>

<body>
	<div class="contents">
		<div class="twocols">
			<div class="navcol">
				<nav>
					<div class="fixedcol">
						<h3>Навигация</h3>
						<ul>
							<li> <a href="/">Главная</a></li>
							<li> <a href="/posts">Посты</a></li>
							<li> <a href="/tags">Теги</a></li>
							<li> <a href="/categories">Категории</a></li>
							<li> <a href="/pages/search">Поиск</a></li>
						</ul>
					</div>
				</nav>
			</div>
			<div class="maincol">
				

<h1 class="title">
  !OBS на Arch Linux
</h1>

<!--Если в странице есть updated, показать её-->

<p class="subtitle"><strong>2023-03-10T00:20:38+05:00</strong></p>


    
         <a href="https://anzix.github.io/tags/linux/">linux</a>

<br>


	<aside id="toc-aside" class="toc">
	    <details>
			<summary>Оглавление</summary>
	        <ol>
	            <li>
	                <a href="#sposoby-ustanovki-obs-na-arch">Способы установки obs на Arch</a>
	                <ol>
	                    <li>
	                        <a href="#ustanovka-flatpak-versii-obs">Установка Flatpak версии OBS</a>
	                    </li><li>
	                        <a href="#nativnaia-ustanovka">Нативная установка</a>
	                    </li>
	                </ol>
	            </li><li>
	                <a href="#obs-vkcapture">obs-vkcapture</a>
	                <ol>
	                    <li>
	                        <a href="#ispol-zovanie-obs-vkcapture">Использование obs-vkcapture</a>
	                    </li>
	                </ol>
	            </li><li>
	                <a href="#striming-i-zapis-obs-plaginom-kodirovshchikom-gstreamer-vaapi-dlia-arch-linux">!Стриминг и запись OBS плагином кодировщиком GStreamer VAAPI для Arch Linux</a>
	                <ol>
	                    <li>
	                        <a href="#sovety-i-rekomendatsii">Советы и рекомендации</a>
	                    </li>
	                </ol>
	            </li>
	        </ol>
		</details>
	</aside>


<ul>
<li><a rel="noopener nofollow noreferrer" target="_blank" href="https://wiki.archlinux.org/title/Open_Broadcaster_Software">Arch Wiki OBS</a></li>
</ul>
<h2 id="sposoby-ustanovki-obs-na-arch"><a class="anchor" href="#sposoby-ustanovki-obs-na-arch">#</a>&nbsp;
Способы установки obs на Arch</h2>
<h3 id="ustanovka-flatpak-versii-obs"><a class="anchor" href="#ustanovka-flatpak-versii-obs">#</a>&nbsp;
Установка Flatpak версии OBS</h3>
<ul>
<li><a rel="noopener nofollow noreferrer" target="_blank" href="https://flathub.org/apps/details/com.obsproject.Studio">Flathub страница Obs</a></li>
<li><a rel="noopener nofollow noreferrer" target="_blank" href="https://www.youtube.com/watch?v=FPjEdrik-eQ">Видео обзор</a></li>
</ul>
<p>Как по мне самый рекомендуемый способ, после установки всё сразу идёт из коробки</p>
<ul>
<li>[Установка Flatpak на Arch Linux]({{&lt; ref "/content/posts/flatpak.md" &gt;}})</li>
</ul>
<p>Установка Flatpak версии obs:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#ffffff;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#f9f9f9;">flatpak</span><span style="color:#ffee80;"> install flathub com.obsproject.Studio
</span></code></pre>
<p>Запуск через консоль:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#ffffff;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#f9f9f9;">flatpak</span><span style="color:#ffee80;"> run com.obsproject.Studio
</span></code></pre>
<h3 id="nativnaia-ustanovka"><a class="anchor" href="#nativnaia-ustanovka">#</a>&nbsp;
Нативная установка</h3>
<p>Установив обычный пакет в офф репо Arch вы не получаете весь функционал OBS а лишь обрезанную его часть. Кому-то это больше нравится, однако obs полностью юзабелен и требует лишь некоторой доработки, для тех кто привык использовать весь функционал obs рекомендую лучше придерживаться установки Flatpak версии.</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#ffffff;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#f9f9f9;">sudo</span><span style="color:#ffee80;"> pacman</span><span style="color:#f9f9f9;"> -S</span><span style="color:#ffee80;"> obs-studio
</span></code></pre>
<h2 id="obs-vkcapture"><a class="anchor" href="#obs-vkcapture">#</a>&nbsp;
obs-vkcapture</h2>
<ul>
<li>https://github.com/nowrep/obs-vkcapture</li>
<li>https://wiki.archlinux.org/title/Open_Broadcaster_Software#Capturing_via_Vulkan/OpenGL</li>
</ul>
<p>В целом вы можете записывать и без данной приблуды</p>
<blockquote>
<p>Вопрос: Для чего нужен vkcapture?</p>
<p>Ответ: Он необходим для захвата игр напрямую через непосредственно API Vulkan или OpenGL который в итоге выжимает ещё больше дополнительной производительности с записи или потока делая всю эту работу менее ресурсоёмкой.</p>
</blockquote>
<p>Требуется версия Obs 27.0 или новее</p>
<p>Есть 2 типа установки на выбор:</p>
<p>Установка для <a rel="noopener nofollow noreferrer" target="_blank" href="http://localhost:1313/posts/obs-on-archlinux/#%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D0%B0%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0">нативного obs</a></p>
<ul>
<li><span style="color:green">РЕКОМЕНДУЕТСЯ</span>: <a rel="noopener nofollow noreferrer" target="_blank" href="https://aur.archlinux.org/packages/obs-vkcapture-git">obs-vkcapture-git</a> (<a rel="noopener nofollow noreferrer" target="_blank" href="https://aur.archlinux.org/packages/lib32-obs-vkcapture-git">lib32-obs-vkcapture-git</a>) собирает AUR пакеты из последнего коммита git т.е является экспериментальной версией</li>
<li><a rel="noopener nofollow noreferrer" target="_blank" href="https://aur.archlinux.org/packages/obs-vkcapture">obs-vkcapture</a> (<a rel="noopener nofollow noreferrer" target="_blank" href="https://aur.archlinux.org/packages/lib32-obs-vkcapture">lib32-obs-vkcapture</a>) собирает AUR пакеты из стабильной релизной ветки, их ставить не надо</li>
</ul>
<blockquote>
<p>Примечание: <a rel="noopener nofollow noreferrer" target="_blank" href="https://aur.archlinux.org/packages/lib32-obs-vkcapture-git">lib32-obs-vkcapture-git</a> необходим для того чтобы захватывать 32bit'ные старые игры по типу (Worms Armageddon и т.д)</p>
</blockquote>
<p>Установка для <a rel="noopener nofollow noreferrer" target="_blank" href="http://localhost:1313/posts/obs-on-archlinux/#%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-flatpak-%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D0%B8-obs">Flatpak OBS</a></p>
<pre data-lang="sh" style="background-color:#2b303b;color:#ffffff;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#f9f9f9;">flatpak</span><span style="color:#ffee80;"> install com.obsproject.Studio.Plugin.OBSVkCapture org.freedesktop.Platform.VulkanLayer.OBSVkCapture
</span></code></pre>
<h3 id="ispol-zovanie-obs-vkcapture"><a class="anchor" href="#ispol-zovanie-obs-vkcapture">#</a>&nbsp;
Использование obs-vkcapture</h3>
<p>В Lutris для отдельной игры открываем Настройки - Параметры системы - ищем "Префикс команды" и вписываем либо одно, либо другое в зависимости от вашей игры.</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#ffffff;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#f9f9f9;">#</span><span style="font-style:italic;color:#0088ff;"> Для OpenGL или Vulkan API
</span><span style="color:#f9f9f9;">obs-gamecapture
</span><span style="color:#f9f9f9;">#</span><span style="font-style:italic;color:#0088ff;"> Только для Vulkan API
</span><span style="color:#f9f9f9;">obs-vkcapture
</span></code></pre>
<p>Сохраняем и запускаем</p>
<p>Для использования в Steam просто прописываем в Параметры запуска игры:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#ffffff;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#f9f9f9;">...</span><span style="color:#ffee80;"> obs-gamecapture ... </span><span style="color:#f9f9f9;">%command%
</span></code></pre>
<p><strong>Для Xorg (X11)</strong>: Запускаем Obs используя команду в терминале: <code>OBS_USE_EGL=1 obs</code></p>
<p>Теперь после запуска у нас в obs появится "Захват игры" и оставляем "Захватывать любое окно". После можно проверить запись игры или начать тестовую трансляцию.</p>
<p><img src="/images/obs-on-archlinux/obs-vkcapture.png" alt="image" /></p>
<h2 id="striming-i-zapis-obs-plaginom-kodirovshchikom-gstreamer-vaapi-dlia-arch-linux"><a class="anchor" href="#striming-i-zapis-obs-plaginom-kodirovshchikom-gstreamer-vaapi-dlia-arch-linux">#</a>&nbsp;
!Стриминг и запись OBS плагином кодировщиком GStreamer VAAPI для Arch Linux</h2>
<ul>
<li><a rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/GStreamer/gstreamer-vaapi">Github страница gstreamer-vaapi</a></li>
<li><a rel="noopener nofollow noreferrer" target="_blank" href="https://wiki.archlinux.org/title/GStreamer#Hardware_video_acceleration">Arch Wiki Gstreamer-Vaapi</a></li>
<li><a rel="noopener nofollow noreferrer" target="_blank" href="https://wiki.archlinux.org/title/Open_Broadcaster_Software#Encoding_using_GStreamer">Arch Wiki OBS кодировщик GStreamer</a></li>
<li><a rel="noopener nofollow noreferrer" target="_blank" href="https://www.reddit.com/r/linux_gaming/comments/w4i3qf/easy_way_to_get_good_4k_60fps_obs_encoding/">Легкая инструкция на Reddit для Arch + Flatpak</a></li>
<li><a rel="noopener nofollow noreferrer" target="_blank" href="https://www.youtube.com/watch?v=RYH15sMwjUg">Видеоинструкция</a></li>
</ul>
<p><a rel="noopener nofollow noreferrer" target="_blank" href="https://www.youtube.com/watch?v=OWouopxGueQ">Видео-тестирование кодировщика GStreamer-Vaapi</a> записанный <a rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/GloriousEggroll">GloriousEggroll</a> (разраб Proton-GE), утверждающий что больше не нужен кодировщик AMF из проприетарных драйверов AMDGPU-PRO. Показывая что кодировщик GStreamer Vaapi в разы лучше AMF и позволяет записывать аж в 4K 60 FPS 60k битрейтом и это всё без перегрузов.</p>
<p>Работает как и на RDNA 2 так и для старых RDNA 1.</p>
<p>Плюсы:</p>
<ul>
<li>Не требуется плагин <a rel="noopener nofollow noreferrer" target="_blank" href="https://aur.archlinux.org/packages/obs-streamfx">obs-streamfx</a></li>
</ul>
<p>Для установки на нативный OBS необходим сам <a rel="noopener nofollow noreferrer" target="_blank" href="https://archlinux.org/packages/extra/x86_64/gstreamer-vaapi/">кодировщик из офф репо Арч</a> и <a rel="noopener nofollow noreferrer" target="_blank" href="https://aur.archlinux.org/packages/obs-gstreamer">плагин из AUR</a> который будет встроен в obs.</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#ffffff;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#f9f9f9;">yay -S</span><span style="color:#ffee80;"> gstreamer-vaapi obs-gstreamer
</span></code></pre>
<p>Для установки для <a rel="noopener nofollow noreferrer" target="_blank" href="http://localhost:1313/posts/obs-on-archlinux/#%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-flatpak-%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D0%B8-obs">Flatpak OBS</a>:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#ffffff;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#f9f9f9;">flatpak</span><span style="color:#ffee80;"> install com.obsproject.Studio.Plugin.Gstreamer org.freedesktop.Platform.GStreamer.gstreamer-vaapi
</span></code></pre>
<p>Опционально требуется:</p>
<blockquote>
<p>Плагин <a rel="noopener nofollow noreferrer" target="_blank" href="http://localhost:1313/posts/obs-on-archlinux/#obs-vkcapture">obs-vkcapture</a></p>
</blockquote>
<p>В настройках obs вкладке "Вывод" будет доступен кодировщик GStreamer Encoder H.264 (выбираете его) и GStreamer Encoder H.265</p>
<p>В Encoder Type выбираем VA-API (не x264 т.к он отвечает за вычисления записи на процессоре)</p>
<p><img src="/images/obs-on-archlinux/1660824506.png" alt="image" /></p>
<p>На этом всё, пробуйте и экспериментируйте, вот какой битрейт необходимо выставлять</p>
<p>Запись:</p>
<ul>
<li>4K (2160p) 60FPS = 65000-60000 bitrate</li>
<li>2K (1440p) 60FPS = 45000-50000 bitrate</li>
<li>Full HD (1080p) 60FPS = 30000 bitrate</li>
</ul>
<p>Трансляция Twitch:</p>
<ul>
<li>Full HD (1080p) = 6000 bitrate</li>
</ul>
<p>Могу порекомендовать вам в тул-баре obs "Док-панели" выбрать "Статистика" она вам поможет для мониторинга cpu, пропусков кадров, fps и т.д.</p>
<h3 id="sovety-i-rekomendatsii"><a class="anchor" href="#sovety-i-rekomendatsii">#</a>&nbsp;
Советы и рекомендации</h3>
<ul>
<li><a rel="noopener nofollow noreferrer" target="_blank" href="https://www.reddit.com/r/linux_gaming/comments/w4i3qf/comment/ih5unkw/?utm_source=share&amp;utm_medium=web2x&amp;context=3">Мелкий совет от Reddit пользователя</a>
<blockquote>
<p>"<em>...Быстрый профессиональный совет по использованию плагина GStreamer. Введите <code>cabac=true</code> в большое поле для дополнительных опций, которое должно дать вам хорошее улучшение соотношения качества/битрейта.</em>"</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>В: Что делает опция cabac?</p>
<p>О: Включает режим энтропийного кодирования cabac</p>
</blockquote>
<ul>
<li><a rel="noopener nofollow noreferrer" target="_blank" href="https://gstreamer.freedesktop.org/documentation/vaapi/vaapih264enc.html?gi-language=c#vaapih264enc:cabac">Source</a></li>
<li><a rel="noopener nofollow noreferrer" target="_blank" href="https://ru.wikipedia.org/wiki/CABAC">Wikipedia о cabac</a></li>
</ul>


				<footer class="center">
					<hr>
					<div class="sociallinks">
						<!--TODO: добавить EMAIL-->
						<a title="Boosty (Поддержать меня)" href="https://boosty.to/an1x" target="_blank"
							rel="noopener nofollow noreferrer" class="eachsociallinks"><img
								src="/assets/images/social-icons/Boosty_Logo.png" alt="Boosty"></a>
						<a title="Я в Steam" href="https://steamcommunity.com/id/An_iX" target="_blank"
							rel="noopener nofollow noreferrer" class="eachsociallinks"><img
								src="/assets/images/social-icons/steam-icon.png" alt="Steam"></a>
						<a title="Мои отчёты в ProtonDB" href="https://www.protondb.com/users/210885854" target="_blank"
							rel="noopener nofollow noreferrer" class="eachsociallinks"><img
								src="/assets/images/social-icons/Proton-logo.svg.png" alt="ProtonDB"></a>
						<a title="Я на GitHub" href="https://github.com/anzix" target="_blank"
							rel="noopener nofollow noreferrer" class="eachsociallinks"><img
								src="/assets/images/social-icons/github.png" alt="GitHub"></a>
						<a href="/rss.xml" target="_blank" rel="noopener nofollow noreferrer" class="eachsociallinks"
							title="Мой RSS фид"><img src="/assets/images/social-icons/rssfeed.png" alt="RSS Фид"></a>
					</div>
					<!-- TODO: Добавить URL лицензии -->
					<p><span class="copyleft">&copy;</span> Авторское право <a href="/">AniX</a>, <a href="!TODO!"
							target="_blank" rel="noopener nofollow noreferrer">AGPL-3.0</a> лицензированный.</p>
					<p>Работает на <a href="https://www.getzola.org/" target="_blank"
							rel="noopener nofollow noreferrer">zola</a>.</p>
				</footer>
			</div>
		</div>
	</div>
</body>

</html>
